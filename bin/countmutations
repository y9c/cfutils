#!/usr/bin/env python

#####################################################################
##          Count Mutations
##  Author: Tyghe Vallard
##  Email: vallardt@gmail.com
##  Date: 10/1/2012
##  Purpose:
##      Count the number of mutations for each sequence in a file generated
##      by mutalign.py by date
##      Output will be mutations<tab>date
##      Sequence names are assumed to be split up by | symbols
##      and the date is in the -4(YYYY), -3(MM), -2(DD) columns
#####################################################################

from optparse import OptionParser
from datetime import date
import sys
import re

sys.path.append('.')
from mutations.count import *

def getoptions( ):
    opt = OptionParser()
    dt = "1900-01-01"
    opt.add_option( '--file', dest='mutations_file', help='File path to .mutations file generated by mutalign.py' )
    opt.add_option( '--date', dest='cutoff_date', default=dt, help='Any sequences before this date will have a negative number. Default: %s' % dt )
    opt.add_option( '--test', dest='test', action='store_true', help='Run tests for this script' )

    options, args = opt.parse_args()

    if not options.mutations_file and not options.test:
        opt.print_help()
        sys.exit( -1 )

    return options

def test( options ):
    cm = CountMutations()
    cm.get_chart( 'mutations/wrair_pH1N1_HA.mutations', parse_date( options.cutoff_date ) )

def main( options ):
    if options.test:
        test( options )
    else:
        cm = CountMutations()
        cm.get_chart( options.mutations_file, parse_date( options.cutoff_date ) )

if __name__ == '__main__':
    options = getoptions( )
    main( options )
